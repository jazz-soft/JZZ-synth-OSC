!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i:"function"==typeof define&&define.amd?define("JZZ.synth.OSC",["JZZ"],i):i(JZZ)}(0,function(t){if(t){t.synth||(t.synth={});var i=t.lib.getAudioContext(),n={},s={_info:function(t){return t||(t="JZZ.synth.OSC"),{type:"Web Audo",name:t,manufacturer:"virtual",version:"1.0.1"}},_openOut:function(t,e){i?(n[e]||(n[e]=new o),t._info=s._info(e),t._receive=function(t){n[e].play(t)},t._resume()):t._crash("AudioContext not supported")}};t.synth.OSC=function(i){return t.lib.openMidiOut(i,s)},t.synth.OSC.register=function(n){return!!i&&t.lib.registerMidiOut(n,s)}}function o(){this.channels=[],this.channel=function(t){return this.channels[t]||(this.channels[t]=new function(){this.notes=[],this.sustain=!1,this.note=function(t){return this.notes[t]||(this.notes[t]=new function(t,n){this.note=t,this.channel=n,this.freq=440*Math.pow(2,(t-69)/12),this.stop=function(){try{this.oscillator&&this.oscillator.stop(0),this.oscillator=void 0,this.sustain=!1}catch(t){}},this.play=function(t){if(!t&&this.channel.sustain||this.stop(),t){var n=t/127;this.oscillator=i.createOscillator(),this.oscillator.type="sawtooth",this.oscillator.frequency.setTargetAtTime(this.freq,i.currentTime,.01),this.oscillator.start||(this.oscillator.start=this.oscillator.noteOn),this.oscillator.stop||(this.oscillator.stop=this.oscillator.noteOff),this.gain=i.createGain();var s=i.currentTime;this.gain.gain.setValueAtTime(n,s),this.gain.gain.exponentialRampToValueAtTime(.01*n,s+2),this.oscillator.connect(this.gain),this.gain.connect(i.destination),this.oscillator.start(0)}else this.sustain=this.channel.sustain}}(t,this)),this.notes[t]},this.play=function(t,i){this.note(t).play(i)},this.allSoundOff=function(){for(var t=0;t<this.notes.length;t++)this.notes[t]&&this.notes[t].stop()},this.damper=function(t){if(!t&&this.sustain!=t)for(var i=0;i<this.notes.length;i++)this.notes[i]&&this.notes[i].sustain&&this.notes[i].stop();this.sustain=t}}),this.channels[t]},this.play=function(t){var i=t[0],n=t[1],s=t[2];if(!(i<0||i>255)){var o=15&i,e=i>>4;9==e?this.channel(o).play(n,s):8==e?this.channel(o).play(n,0):11==e&&(120==n||123==n?this.channel(o).allSoundOff():64==n&&this.channel(o).damper(!!s))}}}});